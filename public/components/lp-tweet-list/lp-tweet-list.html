<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../lp-tweet/lp-tweet.html">

<!--
Element providing solution to no problem in particular.

##### Example

    <lp-tweet-list tweets filter></lp-tweet-list>

@element lp-tweet-list
@blurb Element providing solution to no problem in particular.
@status alpha
@homepage http://jeshuamaxey.github.io/lp-tweet-list
-->
<polymer-element name="lp-tweet-list" attributes="tweets filterBy sortBy">

  <template>

    <link rel="stylesheet" href="lp-tweet-list.css" />

    <template repeat="{{tweet in tweets}}">
      <lp-tweet tweet="{{tweet}}"></lp-tweet>
    </template>
    

  </template>

  <script>

    Polymer('lp-tweet-list', {
      'allTweets': [],
      /*
       * Store a backup of all tweets the first time they come in
       **/
      tweetsChanged: function() {
        if(!this.allTweets.length)
          this.allTweets = this.tweets;
      },
      /**
       * An object containing all the filter functions
       */
      'filters': {
        // test filter function
        firstFive: function(tweets) {
          return tweets.splice(0,5);
        },
        // returns array of tweets with media (pic/vid)
        media: function(tweets) {
          var newTweets = [];
          tweets.forEach(function(tweet) {
            if(tweet.entities.media) {
              newTweets.push(tweet);
            }
          });
          console.log(tweets)
          return newTweets;
        },
        // returns array of tweets with links
        links: function(tweets) {
          var newTweets = [];
          tweets.forEach(function(tweet) {
            if(tweet.entities.urls.length) {
              newTweets.push(tweet);
            }
          });
          console.log(newTweets)
          return newTweets;
        },
        // returns array of retweets
        rts: function(tweets) {
          var newTweets = [];
          tweets.forEach(function(tweet) {
            if(!tweet.retweeted_status) {
              newTweets.push(tweet);
            }
          });
          return newTweets;
        },
        // returns array of tweets which are text only
        text: function(tweets) {
          var newTweets = [];
          tweets.forEach(function(tweet) {
            if(!tweet.entities.urls.length && !tweet.entities.media) {
              newTweets.push(tweet);
            }
          });
          return newTweets;
        },
        // returns array of tweets with geolocation data
        location: function(tweets) {
          var newTweets = [];
          tweets.forEach(function(tweet) {
            if(tweet.coordinates) {
              newTweets.push(tweet)
            };
          });
          return newTweets;
        }
      },

      /**
       * An object containing all the sorting functions
       *
       */
      'sorters': {
        // test sorting function
        reverse: function(arr) {
          return arr.reverse();
        }
      },
       
      filterByChanged: function() {
        if(this.filterBy != 'none') {
          this.tweets =  this.filters[this.filterBy](this.allTweets);
        } else {
          this.tweets = this.allTweets;
        }
      },

      sortByChanged: function() {
        console.log('sortBy = '+ this.sortBy);
        this.tweets =  this.sorters[this.sortBy](this.allTweets);
      }

    });

  </script>

</polymer-element>
